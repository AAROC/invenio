## $Id$

## This file is part of the CERN Document Server Software (CDSware).
## Copyright (C) 2002 CERN.
##
## The CDSware is free software; you can redistribute it and/or
## modify it under the terms of the GNU General Public License as
## published by the Free Software Foundation; either version 2 of the
## License, or (at your option) any later version.
##
## The CDSware is distributed in the hope that it will be useful, but
## WITHOUT ANY WARRANTY; without even the implied warranty of
## MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
## General Public License for more details.
##
## You should have received a copy of the GNU General Public License
## along with CDSware; if not, write to the Free Software Foundation, Inc.,
## 59 Temple Place, Suite 330, Boston, MA 02111-1307, USA.
<?
<protect>
## $Id$
## DO NOT EDIT THIS FILE!  IT WAS AUTOMATICALLY GENERATED FROM CDSware WML SOURCES.


   ##
   ## Description:   function Test_File_Size
   ##                This function compares the size of the transfered file
   ##		     with the min and max size passed as parameter
   ## Author:	     T.Baron
   ## PARAMETERS:    minsize: minimum file size in octets
   ##                maxsize: maximum file size in octets

   function Test_File_Size($param_array,$MAINPATH)
   {

      $maxsize = $param_array[maxsize];
      $minsize = $param_array[minsize];

      //get the details concerning the last uploaded file
      if (file_exists("$MAINPATH/lastuploadedfile"))
      {
         $fp = fopen("$MAINPATH/lastuploadedfile","r");
	 $file_name = fread($fp,filesize("$MAINPATH/lastuploadedfile"));
	 fclose($fp);

	 $file_size = filesize("$MAINPATH/files/$file_name");

	 // Check that a valid max and min file size was selected from the 
	 // database
	 if (($maxsize == 0)&&($minsize == 0)) 
	 {
	    //if no file size found then set the defaults
	    $maxsize = 30000000;
	    $minsize = 1;
	 } 

	 // test max and min file sizes.
	 if($file_size >= $maxsize)
	 {
	    print "<SCRIPT>alert(\"File size of $file_name ($file_size o)"
	       . " exceeds the maximum size limit ($maxsize o). This file"
	       . " will be removed please check the file and retry\");"
	       . "</SCRIPT>";
	    unlink ("$MAINPATH/files/$file_name");
	    unlink("$MAINPATH/lastuploadedfile");
	 }
	 else if($file_size <= $minsize)
	 {
	    print "<SCRIPT>alert(\"File size of $file_name ($file_size o) is"
	       . " smaller than the minimum size limit ($minsize o). This"
	       . " file will be removed please check the file and retry\");"
	       . "</SCRIPT>";
	    unlink ("$MAINPATH/files/$file_name");
	    unlink("$MAINPATH/lastuploadedfile");
	 }
      }
   }//end function Test_File_Size
</protect>
?>
